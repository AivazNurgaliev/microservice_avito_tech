Ссылка: https://github.com/avito-tech/internship_backend_2022
 
- [X] Сделана документация с помощью __Swagger__
- [X] Реализована разрезервация средств
- [X] Компании предотавляется отчёт по определённому периоду в CSV файле
- [X] Реализован метод получения транзакций с комментариями откуда и за что
- [X] Реализована пагинация
- [X] Реализована сортировка по дате и сумме
```sh 
Это моя первая программа на GO! Мне безумно понравился язык. Но ввиду не опытности
вышел не очень хороший код.
Пишу на GO всего три дня, раньше писал на Java 
```
К сожалению, не получилось упаковать данный проект в Docker.

## Swagger
Находится по этому пути, но лучше запросы тестировать в __Postman__ (!!!)
```sh 
http://localhost:4000/static/swagger
```

## Запуск
1) Склонировать git репозиторий
2) Создание БД по скрипту в папке scripts(postgresSQL)
3) Если не скачались библиотеки, то пропишем следущие команды:
go get github.com/lib/pq 
go get github.com/julienschmidt/httprouter
go get github.com/tkanos/gonfig
4) Запускаем из ./cmd/api
5) go run . или прямо из директории go run ./cmd/api
6) (!!!) Все запросы осуществлялись через Postman

## Файл конфигурации Базы Данных
#### В папке config есть файл config.json, нужно указать данные для входа в свою БД

## Работа сервиса:

Для начала надо __пополнить__ баланс пользователя: 
Метод PUT
```sh 
http://localhost:4000/account/add/:id/:account_cash
```
id = аккаунт пользователя, на который хотим пополнить счёт
(если id не существует, то такой пользователь создаётся)
account_cash = сумма.

__Создание__ __услуги__, чтобы пользователи могли купить её:

Метод POST
```sh 
http://localhost:4000/service/create/:name/:price
```
name = имя услуги
price = стоимость этой услуги

Теперь можно __переводить__ деньги между пользователями(транзакции):

Метод PUT
```sh 
http://localhost:4000/account/transfer/:id/:ToId/:account_cash
```
id = Отправитель перевода

ToId = Получатель перевода

account_cash = Сумма перевода

Метод PUT
__Пополнение__ счёта: 
```sh
http://localhost:4000/account/add/:id/:account_cash
```

Метод PUT
__Снятие__ денег:
```sh
http://localhost:4000/account/withdrawal/:id/:account_cash
```
id = Пользователь, который снимает деньги
account_cash = сумма.

Проверки на отрицательность счёта предусмотрена

Записи снятия, пополнения и переводов между пользователями создаются
в таблице __transaction_history__.

Метод PUT
Если же пользователь хочет купить услугу:
```sh
http://localhost:4000/account/reserv/:id_account/:id_service
```
id_account = Пользователь, который хочет купить услугу
id_service = Услуга, которую он хочет преобрести

Этот запрос позволяет __зарезервировать__ средства пользователя
и поместить запись в temp_report(временная таблица для резервации)

Проверка на корректность резервации тоже имеется.

Метод PUT
Теперь __признаем__ операцию:
```sh
http://localhost:4000/report/create/:id
```
id = Айди из temp_report

Получение(get):
```sh
http://localhost:4000/report/get/:id
```
Происходит следущее: создаем записть в report, удаляем из temp_report
Списываем зарезервированные средства

Реализована: резервация и разрезервация


## Получение отчёта(Доп задание 1)

Получение отчета по купленным услугам(Год, Месяц)

Метод GET
```sh
http://localhost:4000/company/report/:year/:month
```
year = год
month = месяц
Создается csv файл в папке reports
для year = 2022, month = 9, то создастся report2022-9.csv

Создается ссылка вида: http://localhost:4000/file/report2022-9.csv

Чтобы открыть этот файл нужно отправить GET запрос:
```sh
http://localhost:4000/file/:filename
```

## Список покупок различных услуг пользователем (Доп задание 2)

Для получения записей определенного пользователя, который покупал разные услуги

Метод GET
```sh
http://localhost:4000/history/user/:id
```

Реализована пагинация и сортировка по дате и сумме
нужно лишь добавить:

```sh
http://localhost:4000/history/user/:id?page=1&page_size=2&sort=sum
```
page = текущая страницв(по умолчанию = 1)

page_size = размер страница(по умолчанию = 5)

sort = тип сортировки

### Типы сортировки:

1) sum - сортировка по сумме в возрастающем порядке
2) -sum - в убывающем
3) date - сортировка по дате в возрастающем порядке
4) -date - в убывающем

Возвращает Метадату о страницах: 
```sh
"metadata": {
  "current_page": 1,
  "page_size": 5,
  "first_page": 1,
  "last_page": 1,
  "total_records": 1
}
```

## Список транзакций пользователя(Доп задание 2)

Аналогично для получения списка транзакций определенного пользователя
```sh
http://localhost:4000/history/transactions/:id?page=1&page_size=2&sort=sum
```

id = пользователь, который хочет получить отчёт по своим транзакцияям/пополнениям/выводам

### Вспомогательные хэндлеры

Получение сервиса (get) http://localhost:4000/service/get/:id

Получение записи о транзакции (get)
http://localhost:4000/transaction/get/:id

Получение аккаунта
http://localhost:4000/account/get/:id

## База данных
account(account_id, баланс и зарезерв. баланс)

report(признание выручки - для отчёта)

service(service_id, название и цена услуги)

temp_report(Зарезервированная услуга для пользователя)

operation(тип операций: снятие, пополнение, перевод)

transaction_history(переводы между пользователями, снятие, пополнение)
